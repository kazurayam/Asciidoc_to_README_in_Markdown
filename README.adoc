= Include directive is not supported in Github-flavored Asciidoc ---- a workaround proposed

== Problem to solve

In a GitHub repository, you can make a file named `README.adoc` in https://asciidoc-py.github.io/index.html[Asciidoc] format. GitHub is able to convert Asciidoc text to HTML runtime so that it renders in browsers. A sample is here:

- https://github.com/kazurayam/IncludeIsNotSupportedInGithubFlavoredAsciidoc-a_workaround/blob/master/article.adoc[article.adoc]

This looks very nice! You can enjoy the Asciidoc capabilities to author your documents and publish them in GitHub.
However, there is a caveat in GitHub Flavored Asciidoc. *GitHub Flavored Asciidoc (GFA) does not support the `include::path/to/file[]` directive.* See the subsection titled "Include directive" at the tail of https://github.com/kazurayam/IncludeIsNotSupportedInGithubFlavoredAsciidoc-a_workaround/blob/master/article.adoc[article.adoc].

image::docs/images/Include_directive_not_working.png[Include directive not working]

I intended to embed the source code of my Java program into the article for reference. I expected to see something as follows.

image::docs/images/Include_directive_as_expected.png[Include directive as expected]

I need the Include directive in Asciidoc. Seriously! The include directive is the very reason why I want to use Asciidoc, instead of Markdown, to author the README doc of my software projects on GitHub. 

Why GitHub does not support Include directive in Asciidoc? --- There is a discussion about it, which was opened 4 years ago and still remain open.

- https://github.com/github/markup/issues/1095[Asciidoctor: support include directives for other asciidoc files #1095]

As far as I learned from this discussion, it seems unlikely that GitHub adds Include directive support in GFA in future. Very disappointing. Any workaround?

== Solution

In https://github.com/github/markup/issues/1095[the discussion], @chevdoor posted a workround at 9th June 2021. Here I will quite his post entirely.

[quote, 'https://github.com/github/markup/issues/1095[Asciidoctor: support include directives for other asciidoc files #1095]']
----
This is by far my favorite workaround although it requires a little setup and tooling.
Install pandoc and asciidoctor, you can then create a new (executable) .gti/hooks/pre-commit file with the following content:


#!/usr/bin/env bash

# convert all the files in the root
find . -iname "*.adoc" -type f -maxdepth 1 -not -name "_*.adoc" | while read fname; do
  target=${fname//adoc/md}
  xml=${fname//adoc/xml}
  echo "converting $fname into $target"

  asciidoctor -b docbook -a leveloffset=+1 -o - "$fname" | pandoc  --markdown-headings=atx --wrap=preserve -t markdown_strict -f docbook - > "$target"
  echo deleting $xml
  rm -f "$xml"
done

# if we find a readme*.md, we rename to README.md
find . -iname "readme*.md" -not -name "README.md" -type f -maxdepth 1 | while read fname; do
  echo Renaming $fname to README.md
  mv $fname README.md
done


The script will look for all the adoc files in the root of your project (except those starting with _) and convert them. Since github picks the asciidoc by default when you have both a README.adoc and a README.md ðŸ¤¦ , I have to further get my README.adoc out of the way renaming to README_src.adoc) and add extra renaming to the script.

To cheer us up, this option comes with a small benefit: your asciidoc is now linted before you ever commit, so you will spot wrong includes paths before your commit makes it in.
----

This worked for me as well.


== Description

I will describe here what I have done to author https://github.com/kazurayam/IncludeIsNotSupportedInGithubFlavoredAsciidoc-a_workaround/blob/master/README.md[README of this repository].

=== Environment

- machine: Mac Book Air
- OS: macOS Monterey v12.0.1

=== External dependencies

==== pandoc

I needed https://pandoc.org/[pandoc], a universal document converter. I installed pandoc using [Homebrew](https://brew.sh/).

[source]
----
$ brew install pandoc
----

==== asciidoctor

I need https://asciidoctor.org/[asciidoctor], A fast text processor & publishing toolchain for converting AsciiDoc to HTML5, DocBook & more. I installed asciidoctor using Homebrew.

[source]
----
$ brew install asciidoctor
----

=== shell script

I added a shell script named `<projectDir>/readmeconv.sh` in the root directory. It contains the code which @chevdoor proposed.

I changed the mode of this file _executable_.

[source]
----
$ chmod +x ./readmeconv.sh
----

=== Git hook

I edited the `<projectDir>/.git/hooks/pre-commit` so that it executes the `readmeconv.sh` script on `git commit`.

[source,shell]
----
include::.git/hooks/pre-commit[]
----

=== GitHub repository setting

In case your GitHub project contains both of `README.md` and `README.adoc`, when you query the project's top URL, GitHub will respond README.adoc instead of README.md as default. I don't like this. I want my project to respond with `README.md` generated by the `readmeconv.sh` script.





== The Result

In the `<projectDir>/README.adoc`, I wrote as follows:

[source]
----
[source,shell]
\----
include::.git/hooks/pre-commit[]
\----
----

Please note I used `include` directive here. And you can see the result at 